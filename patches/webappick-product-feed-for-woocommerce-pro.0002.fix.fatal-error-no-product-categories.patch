From 9d793b4333cd3c20bf470aeb7de7d83db5a8f20a Mon Sep 17 00:00:00 2001
From: Daniel Kudwien <daniel@netzstrategen.com>
Date: Mon, 28 Feb 2022 11:23:08 +0100
Subject: [PATCH] Fixed fatal error during product feed generation if product
 does not have categories assigned.

---
 .../includes/pluggable.php                                     | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/libs/webappick-product-feed-for-woocommerce/includes/pluggable.php b/libs/webappick-product-feed-for-woocommerce/includes/pluggable.php
index d3aee9dc8..bc14b4b52 100755
--- a/libs/webappick-product-feed-for-woocommerce/includes/pluggable.php
+++ b/libs/webappick-product-feed-for-woocommerce/includes/pluggable.php
@@ -27,7 +27,7 @@ if ( ! function_exists( 'woo_feed_get_category_mapping_value' ) ) {
         }
 
         //get product terms
-        $categories = array_reverse( get_the_terms( $product_id, 'product_cat' ) );
+        $categories = get_the_terms( $product_id, 'product_cat' );
 
         //get cmapping value
         if( in_array( $getValue['mappingprovider'], $suggestive_category_list_merchants ) && isset( $getValue['gcl-cmapping'] ) ) {
@@ -38,6 +38,7 @@ if ( ! function_exists( 'woo_feed_get_category_mapping_value' ) ) {
 
         // Fixes empty mapped category issue
         if ( ! empty( $categories ) && is_array( $categories ) && count( $categories ) ) {
+            $categories = array_reverse( $categories );
             foreach ( $categories as $category ) {
                 if ( isset( $cmapping[ $category->term_id ] ) && ! empty( $cmapping[ $category->term_id ] ) ) {
                     $cat_map_value = $cmapping[ $category->term_id ];
-- 
2.24.4

