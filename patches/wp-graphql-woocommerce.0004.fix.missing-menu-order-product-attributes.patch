From 2fdcef1285b91894f633901904901ffe151976a4 Mon Sep 17 00:00:00 2001
From: creative-andrew <andres@netzstrategen.com>
Date: Mon, 26 May 2025 10:57:24 +0200
Subject: [PATCH] fix: missing menu order in product attributes

---
 includes/class-type-registry.php              |  2 +-
 includes/class-wp-graphql-woocommerce.php     |  1 +
 includes/connection/class-wc-terms.php        |  9 ++-
 ...uct-attributes-connection-orderby-enum.php | 62 +++++++++++++++++++
 4 files changed, 72 insertions(+), 2 deletions(-)
 create mode 100644 wp-content/plugins/wp-graphql-woocommerce/includes/type/enum/class-product-attributes-connection-orderby-enum.php

diff --git a/includes/class-type-registry.php b/includes/class-type-registry.php
index c679b54ada..2069f9c632 100644
--- a/includes/class-type-registry.php
+++ b/includes/class-type-registry.php
@@ -46,7 +46,7 @@ class Type_Registry {
 		Type\WPEnum\Product_Attribute_Enum::register();
 		Type\WPEnum\Attribute_Operator_Enum::register();
 		Type\WPEnum\Currency_Enum::register();
-
+		Type\WPEnum\Product_Attributes_Connection_Orderby_Enum::register();
 		/**
 		 * InputObjects.
 		 */
diff --git a/includes/class-wp-graphql-woocommerce.php b/includes/class-wp-graphql-woocommerce.php
index bd99096c33..af3ffbdfb2 100644
--- a/includes/class-wp-graphql-woocommerce.php
+++ b/includes/class-wp-graphql-woocommerce.php
@@ -239,6 +239,7 @@ if ( ! class_exists( '\WPGraphQL\WooCommerce\WP_GraphQL_WooCommerce' ) ) :
 			require $include_directory_path . 'type/enum/class-attribute-operator-enum.php';
 			require $include_directory_path . 'type/enum/class-product-attribute-enum.php';
 			require $include_directory_path . 'type/enum/class-currency-enum.php';
+			require $include_directory_path . 'type/enum/class-product-attributes-connection-orderby-enum.php';
 
 			// Include interface type class files.
 			require $include_directory_path . 'type/interface/class-attribute.php';
diff --git a/includes/connection/class-wc-terms.php b/includes/connection/class-wc-terms.php
index 710271020a..3df79ee87e 100644
--- a/includes/connection/class-wc-terms.php
+++ b/includes/connection/class-wc-terms.php
@@ -118,7 +118,14 @@ class WC_Terms extends TermObjects {
 				'toType'         => 'TermNode',
 				'queryClass'     => 'WP_Term_Query',
 				'fromFieldName'  => 'terms',
-				'connectionArgs' => self::get_connection_args(),
+				'connectionArgs' => self::get_connection_args(
+					[
+						'orderby' => [
+							'type'        => 'ProductAttributesConnectionOrderbyEnum',
+							'description' => __( 'Field(s) to order terms by. Defaults to \'name\'.', 'wp-graphql-woocommerce' ),
+						],
+					]
+				),
 				'resolve'        => static function ( $source, array $args, AppContext $context, ResolveInfo $info ) {
 					if ( ! $source->is_taxonomy() ) {
 						throw new UserError( __( 'Invalid product attribute', 'wp-graphql-woocommerce' ) );
diff --git a/includes/type/enum/class-product-attributes-connection-orderby-enum.php b/includes/type/enum/class-product-attributes-connection-orderby-enum.php
new file mode 100644
index 0000000000..d77afb973b
--- /dev/null
+++ b/includes/type/enum/class-product-attributes-connection-orderby-enum.php
@@ -0,0 +1,62 @@
+<?php
+/**
+ * WPEnum Type - Product_Attributes_Connection_Orderby_Enum
+ *
+ * @package WPGraphQL\WooCommerce\Type\WPEnum
+ * @since   0.2.2
+ */
+
+namespace WPGraphQL\WooCommerce\Type\WPEnum;
+
+/**
+ * Class Product_Attributes_Connection_Orderby_Enum
+ */
+class Product_Attributes_Connection_Orderby_Enum {
+	/**
+	 * Registers type
+	 *
+	 * @return void
+	 */
+	public static function register() {
+		register_graphql_enum_type(
+			'ProductAttributesConnectionOrderbyEnum',
+			[
+				'description' => __( 'Product attributes connection orderby enum', 'wp-graphql-woocommerce' ),
+				'values'      => [
+					'NAME'        => [
+						'value'       => 'name',
+						'description' => __( 'Order the connection by name.', 'wp-graphql-woocommerce' ),
+					],
+					'SLUG'        => [
+						'value'       => 'slug',
+						'description' => __( 'Order the connection by slug.', 'wp-graphql-woocommerce' ),
+					],
+					'TERM_GROUP'  => [
+						'value'       => 'term_group',
+						'description' => __( 'Order the connection by term group.', 'wp-graphql-woocommerce' ),
+					],
+					'TERM_ID'     => [
+						'value'       => 'term_id',
+						'description' => __( 'Order the connection by term id.', 'wp-graphql-woocommerce' ),
+					],
+					'TERM_ORDER'  => [
+						'value'       => 'term_order',
+						'description' => __( 'Order the connection by term order.', 'wp-graphql-woocommerce' ),
+					],
+					'MENU_ORDER'  => [
+						'value'       => 'menu_order',
+						'description' => __( 'Order the connection by woocommerce menu order.', 'wp-graphql-woocommerce' ),
+					],
+					'DESCRIPTION' => [
+						'value'       => 'description',
+						'description' => __( 'Order the connection by description.', 'wp-graphql-woocommerce' ),
+					],
+					'COUNT'       => [
+						'value'       => 'count',
+						'description' => __( 'Order the connection by item count.', 'wp-graphql-woocommerce' ),
+					],
+				],
+			]
+		);
+	}
+}
\ No newline at end of file
-- 
2.24.4

