From b5e4083ee7cd56cfdf3fe25ef030dc08479fee8b Mon Sep 17 00:00:00 2001
From: Bogdan Arizancu <bogdan@netzstrategen.com>
Date: Thu, 8 Apr 2021 14:56:43 +0200
Subject: [PATCH] Fixed woocommerce-german-market invokes admin_url() for many
 string translations. (performance) (#626)

---
 WooCommerce-German-Market.php | 10 +++++-----
 inc/WGM_Installation.php      |  6 ++++--
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/WooCommerce-German-Market.php b/WooCommerce-German-Market.php
index 465c65ec8..76f35c98a 100644
--- a/WooCommerce-German-Market.php
+++ b/WooCommerce-German-Market.php
@@ -277,11 +277,6 @@ class Woocommerce_German_Market {
 			}
 		}
 
-		/**
-		* WC 3.4 Information in Customizer
-		**/
-		add_filter( 'gettext', array( 'WGM_Installation', 'wc_3_4_info' ), 10, 3 );
-
 		WGM_Shortcodes::register();
 
 		do_action( 'german_market_after_general_init' );
@@ -465,6 +460,11 @@ class Woocommerce_German_Market {
 		add_action( 'admin_notices',											array( 'WGM_Installation', 'upgrade_deliverytimes_notice' ) );
 		add_action( 'current_screen',											array( 'Woocommerce_German_Market', 'media_uploader' ) );
 
+		/**
+		* WC 3.4 Information in Customizer
+		**/
+		add_filter( 'gettext', array( 'WGM_Installation', 'wc_3_4_info' ), 10, 3 );
+
 		/**
 		 * WooCommerce Settings
 		 */
diff --git a/inc/WGM_Installation.php b/inc/WGM_Installation.php
index 6cccbae47..11d28fc64 100644
--- a/inc/WGM_Installation.php
+++ b/inc/WGM_Installation.php
@@ -816,15 +816,17 @@ Class WGM_Installation {
 
     	if ( $domain == 'woocommerce' ) {
 
-    		$german_market_settings_page = admin_url( 'admin.php?page=german-market&tab=general&sub_tab=checkout_checkboxes' );
-
     		if ( 	$text == 'Optionally add some text about your store privacy policy to show during checkout.' || 
     				$text == 'Optionally add some text for the terms checkbox that customers must accept.' ) {
 
+    					$german_market_settings_page = admin_url( 'admin.php?page=german-market&tab=general&sub_tab=checkout_checkboxes' );
+
     					$translated_text .= '<br /><b>' . sprintf( __( 'Possibly, this customizer setting is not effective because it has been adopted and expanded by German Market. It can be found %shere%s.', 'woocommerce-german-market' ), '<a href="' . $german_market_settings_page . '">', '</a>' ) . '</b/>';
     	
     		} else if ( $text == 'This section controls the display of your website privacy policy. The privacy notices below will not show up unless a privacy page is first set.' ) {
 
+    			$german_market_settings_page = admin_url( 'admin.php?page=german-market&tab=general&sub_tab=checkout_checkboxes' );
+
     			$translated_text .= '<br /><br /><b>' . sprintf( __( 'Possibly, these settings are not effective because they have been adopted and expanded by German Market. They can be found %shere%s.', 'woocommerce-german-market' ), '<a href="' . $german_market_settings_page . '">', '</a>' ) . '</b>';
 
     		} 
-- 
2.30.1

